
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>app</title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="telephone=no" name="format-detection" />
<link href="css/jquery.mobile-1.3.2.css" rel="stylesheet" type="text/css" media="screen, projection" />
<link href="css/jquery.mobile.my.css" rel="stylesheet" type="text/css" media="screen, projection" />
<link href="css/my.mobile-1.0.css" rel="stylesheet" type="text/css" media="screen, projection" />

<script type="text/javascript" src="css/jquery-1.10.2.js"></script>
<script type="text/javascript" src="css/jquery.mobile-1.3.2.js"></script>
<script type="text/javascript" src="css/jquery.nivo.slider-3.2.js"></script>
<script type="text/javascript" src="css/swipe-2.0.js"></script>
<script type="text/javascript" src="css/jquery.lazyload.js"></script>


<link href="fivegold.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="iscroll-lite.js"></script>
      				<script type="text/javascript" src="iscroll.js"></script>
<script type="text/javascript" src="fivegold.js"></script>

<!-- load the json2 library (required for jstorage use) -->
<script src="json2.js"></script>
<!-- load the jstorage library -->
<script src="jstorage.js"></script>
<script language="javascript">
var addressid = 0;
function genOrder(){
     var userid = $.jStorage.get('userid');
         if (userid==null)
        document.location.href="login.html";
      //document.location.href="addressMange.html";
	var xhr = new XMLHttpRequest();
	xhr.open("GET", "http://120.24.209.210/api/mobile.php?act=generateorders&user_id="+userid, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    		var resultfromphp = xhr.responseText;
			//alert(resultfromphp);
			
			 var objData = jQuery.parseJSON(resultfromphp);
			
			
			 if (objData.consignee){
			 if (objData.consignee.length==0){
			 	document.location.href="newaddress.html";
			 }
			var html ='';
			
			 if (objData.consignee.length>0){
			      var i = 0;
				// html+= '<li><h1>收货人信息</h1><select size="1" class="selector" id="selector_consignee">';
				 $.each(objData.consignee, function (index, term) {
		  	 	 //html+=' <option value="'+term.address_id+'">'+term.consignee+'('+term.address+')('+term.tel+')</option>';
		     		  //alert(i);
		     		  if (i==0){;
		     		  addressid = term.address_id;
		     		html+='<section id="address_info" class="address_info">';
		            html+='<section class="address_name">'+term.consignee+'&nbsp;'+term.mobile+'</section>';
			     html+='<section class="address_content">'+term.address+'</section>';
		   		  html+='</section>';
		   		   i=1;
		   		  }
		     		});
		     			document.getElementById('addressHtml').innerHTML=html;
		     		//html+='</select></li>';
			 }

                   // html+='<li><h1>收货人信息</h1><p>收货人姓名:'+objData.consignee.consignee+'</p><p>收货人详细地址:'+objData.consignee.address+'</p></li>';
			if (objData.cart_goods.length>0){
			 html ='';
		     html +='<section>';
                 html +=' <ul>';
				 $.each(objData.cart_goods, function (index, term) {
			 	//html+='<li><img src="'+term.goods_thumb+'"/><h1>购物车商品</h1><p>商品名称:'+term.goods_name+'</p><p>商品数量:'+term.goods_number+'</p><p>商品价格:¥'+term.goods_price+'</p></li>';
			 	     html +='<li class=\"clearfix\" style=\"margin-bottom:5px;\"><a class=\"pro_img\" href=\"#\" data-ajax=\"false\">';
	            html+='<img alt=\"'+term.goods_name+'\" width=\"60\" height=\"60\" src=\"'+term.goods_thumb+'\"></a>';
	            html+='<p class=\"pro_name\">'+term.goods_name+'（）</p>';
	            html+='<p class=\"pro_price\">共'+term.goods_number+'件<span>￥'+term.goods_price+'</span></p></li>';
              
			 	});
			 	
			 	html +=' </ul>';
			 	   html +='</section>';          
			 	 document.getElementById('goodsHtml').innerHTML=html;         
			 }
			 //html+='<li><h1>总计</h1><p>商品数量:'+objData.total.real_goods_count+'</p><p>商品总价:¥'+objData.total.goods_price+'</p><p><s>市场总价:¥'+objData.total.market_price+'</s></p><p>节省了:¥'+objData.total.saving_formated+'</p></li>';
		      document.getElementById('goodsprice').innerHTML='¥'+objData.total.goods_price;         
		    document.getElementById('totalprice').innerHTML='¥'+objData.total.goods_price;         
		    
               
		       if (objData.shipping_list.length>0){
				 //html+= '<li><h1>快递方式</h1><select size="1" class="selector" id="selector_ship">';
				 $.each(objData.shipping_list, function (index, term) {
		  	 	 //html+=' <option value="'+term.shipping_id+'">'+term.shipping_name+'(¥'+term.shipping_fee+')</option>';
		     		 //document.getElementById('shipprice').innerHTML='¥'+term.shipping_fee;      
		     		 //alert(term.shipping_fee)	;
		     		});
		     		
		     		//html+='</select></li>';
			 }
			 /*if (objData.payment_list.length>0){
				 html+= '<li><h1>支付方式</h1><select size="1" class="selector" id="selector_payment">';
				 $.each(objData.payment_list, function (index, term) {
			       html+=' <option value="'+term.pay_id+'">'+term.pay_name+'(手续费:¥'+term.format_pay_fee+')</option>';
			 		});
			 		html+='</select></li>';
			 }
		      */
			 //$('#listallcat').append($(html));
                   // $('#listallcat').trigger('create');    
                   //$('#listallcat').listview('refresh');
                   }
                   if (objData.rsgcode){
			 	//alert(objData.rsgmsg);
			 	document.location.href="nocart.html";
			 }
			 
  		}
	};
	xhr.send();
	
}


function addOrder(){
     var shippingid = 1;//$("#selector_ship").val();
     //alert (shippingid);
     var paymentid = 1;//$("#selector_payment").val();
     //var addressid = $("#selector_consignee").val()
     var memo=$("#memo").val()
    var need_inv=0;//1要，0不要;
    var inv_type=' ';//发票类型
    var postscript=memo;	//用户备注
    var userid = $.jStorage.get('userid');
    if (userid==null)
        document.location.href="login.html";
   var posturl="http://120.24.209.210/api/mobile.php?act=orderconfirmation&user_id="+userid+"&mode=test&shipping_id="+shippingid+'&pay_id='+paymentid+'&need_inv='+need_inv+'&address_id='+addressid+'&postscript='+postscript;
   //alert (posturl);
      var xhr = new XMLHttpRequest();
	xhr.open("GET", posturl, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    		var resultfromphp = xhr.responseText;
			//alert(resultfromphp);
			
			 //var objData = jQuery.parseJSON(resultfromphp);
			 document.location.href="mmember-orders.html";
  		}
	};
	xhr.send();
	
}

$(document).ready(function() {
  genOrder();
});
</script>

<style>
.user-ui-footer {
	font-size: 20px;
	color: #ffffff;
	background: #b3a99f;
	line-height: 50px;
	text-align: center;
}
</style>
</head>
<body><div data-role="page" id="cart" data-title="我的订单">
	<!-- header -->
	<div data-role="header" data-theme="h">
	    <a href="#" data-role="button" data-iconpos="notext" data-icon="arrow-l" data-ajax="false"></a>
	    <h1>订单确认</h1>
	</div>
	<!-- /header -->
	<div data-role="content">
	    <form id="order_form" action="morder-load.html" method="post" data-ajax="false">
	    <input type="hidden" id="md5_cart_info" name="md5_cart_info" value="045e1bbcf0a96c8d88903448adaadd05">
	    <input type="hidden" id="area" name="area" value="135">
	    <!-- 收货地址 -->
	    <section class="checkout_section address_section">
	         <section class="checkout_title">收货地址</section>
	         <div id="addressHtml">
	        
		     </div>
	    </section>
	    <!-- 支付方式 -->
	    <section class="checkout_section payment_section">
	         <section class="checkout_title">支付方式</section>
	         <section id="shippinglist">
	           <input type="radio" data-role="none" name="delivery[shipping_id]" id="shipping_6"  value="6" checked="checked" onclick="check_payment(1)">
			   <label for="shipping_6">快递：网上支付</label>
			   			   <input type="radio" data-role="none" name="delivery[shipping_id]" id="shipping_2"  value="2" onclick="check_payment(-1)">
			   <label for="shipping_2">快递：货到付款</label>
			   			   <input type="hidden" id="pay_app_id" name="payment[pay_app_id]" value="99bill">
	         </section>
	    </section>
	    	    <input type="hidden" id="is_tax" name="payment[is_tax]"  value="false" />


	            <section class="checkout_section product_section">
              <section class="checkout_title">商品信息（<a href="gencart.html" data-ajax="false">修改</a>）</section>
              <div id="goodsHtml">
            
              </div>
        </section>

        <section class="checkout_section product_section">
              <section class="checkout_title">备注(最多输入50个文字)</section>
	          <section>
	              <input type="text" id="memo" name="memo" maxlength="50">
	          </section>
        </section>
        <section class="checkout_section price_section">
              <section class="clearfix"><label>商品总价</label><span id='goodsprice'><span></section>
                            <section class="clearfix"><label>运费金额</label><span id='shipprice'>¥0<span></section>
                            <section class="clearfix"><label>应付金额</label><span id='totalprice'><span></section>
        </section>
        <section style="padding:5px 5px;">
	    	<input type="button" value="提交订单" data-theme="f" data-icon="check" data-mini="false" onclick="addOrder()">
	    </section>
	    </form>
	</div>
	<!-- /content -->
	<!-- footer -->
	<div data-role="footer" data-theme="c">
    </div>
	</div>
<!-- /page -->
</body>
</html>