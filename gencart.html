
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>购物车</title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta content="telephone=no" name="format-detection" />
<link rel="stylesheet" href="css/bootstrap.min.css">
<script src="css/jquery-1.10.2.min.js"></script>
<script src="css/bootstrap.min.js"></script>
<link href="css/base.mobile.css" rel="stylesheet" type="text/css" media="screen, projection" />


<link href="fivegold.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="iscroll-lite.js"></script>
      				<script type="text/javascript" src="iscroll.js"></script>
<script type="text/javascript" src="fivegold.js"></script>
<style>
.public_section .href_info {
	position: relative;
	padding-right: 30px;
}

.public_section .href_info:after {
	-webkit-transform: rotate(-45deg);
	-moz-transform: rotate(-45deg);
	-ms-transform: rotate(-45deg);
	-o-transform: rotate(-45deg);
	margin-top: -5px;
	right: 15px;
	content: '';
	position: absolute;
	width: 6px;
	height: 6px;
	top: 50%;
	border-color: #444;
	border-style: solid;
	border-width: 0 2px 2px 0;
}
.user-ui-header{
	font-size:20px;
	color:#ffffff;
	background:#b3a99f;
	line-height:50px;
	text-align: center;
}
.user-ui-header .left-bar{
	float:left;
	padding-left:10px;
	color:#ffffff;
}

.user-ui-header .right-bar{
	float:right;
	padding-right:10px;
	color:#ffffff;
}
.user-ui-content{
	padding:10px 10px;
}
.user-ui-footer {
	font-size: 20px;
	color: #ffffff;
	background: #b3a99f;
	line-height: 50px;
	text-align: center;
}
</style>
<script type="text/javascript" src="fivegold.js"></script>
    <script>	
function makeList() {
    //var userid = request('catid');
	var userid = 24;
	//alert(catid);
	var xhr = new XMLHttpRequest();
	xhr.open("GET", "http://120.24.209.210/api/mobile.php?act=buylistcart&user_id="+userid, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    		var resultfromphp = xhr.responseText;
			//alert(resultfromphp);
			var html ='';
      		  var objData = jQuery.parseJSON(resultfromphp);
			   $.each(objData.goods_list, function (index, term) {
			html+="<table class=\"table\"><tr><td valign=\"top\" width=\"100px\"><img class=\"img-rounded\" width=\"100\" height=\"100\" src=\""+term.original_img+"\"></td><td><p>"+term.goods_name+"（";
			$.each(term.goods_attr, function (index, att) 							{
			html+=att.name+"："+att.value;
			});
			html+="）</p><p>单价：￥"+term.goods_price+"</p><div class=\"form-group\"><a class=\"btn btn-info\" id=\"minus_product\"   onClick=\"update_minus('goods_"+term.rec_id+"')\">-</a><input class=\"form-control\" style=\"width:40px;display:inline-block;\" type=\"text\" id=\"goods_"+term.rec_id+"\" min=\"1\" max=\"10\" value=\""+term.goods_number+"\"><a class=\"btn btn-info\" id=\"plus_product\"   onClick=\"update_plus('goods_"+term.rec_id+"')\">+</a></div><section><a href=\"javascript:delcart("+term.rec_id+")\" data-ajax=\"false\" data-rel=\"popup\" data-position-to=\"window\" data-transition=\"pop\" data-icon=\"delete\" data-theme=\"d\">删除</a>     </section></td></tr></table>";
			});
			   //alert(html);
			document.getElementById('catHtml').innerHTML=html;

document.getElementById('total').innerHTML="<p>商品总金额：￥"+objData.total.goods_price+"</p>";		 
  		}
	};
	xhr.send();
	
}

$(document).ready(function() {
	//alert('hi');
	 makeList();
});


function delcart(recid){

    var xhr = new XMLHttpRequest();
	xhr.open("GET", "http://120.24.209.210/api/mobile.php?act=delbuycart&rec_id="+recid, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    		var resultfromphp = xhr.responseText;
				//alert (resultfromphp);
			//alert ('删除成功');
				var objData = jQuery.parseJSON(resultfromphp);
			//alert(objData.rsgmsg);
			 //$('#listallcat').removeData(;
			 document.location.href="gencart.html";
				// makeList();
  		}
	};
	xhr.send();
}

 function update_minus(e){
	    	$num = $('#'+e).val();
	    	$num--;
	    	if($num<=1){
	    		$('#'+e).val(1);
	    		//update_cart(e,1);  //
	    	}else{
	    		$('#'+e).val($num);
	    		//update_cart(e,$num);
	    	}

	    }

	    function update_plus(e){
	    	$num = $('#'+e).val();
	    	$num++;
	    	if($num>=10){
	    		$('#'+e).val(10);
	    		//update_cart(e,10);
	    	}else{
	    		$('#'+e).val($num);
	    		//update_cart(e,$num);
	    	}
	    }
		
		function emptycart() {
    //var userid = request('catid');
	var userid = 24;
	//alert(catid);
	var xhr = new XMLHttpRequest();
	xhr.open("GET", "http://120.24.209.210/api/mobile.php?act=emptycart&user_id="+userid, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    		var resultfromphp = xhr.responseText;
			//alert(resultfromphp);
			//var html ='';
      		  var objData = jQuery.parseJSON(resultfromphp);
			document.location.href="gencart.html";
  		}
	};
	xhr.send();
	
}
</script>
</head>
<body><div class="user-ui-page">
	<!-- header -->
	<div class="user-ui-header clearfix" id="header">
	      <a class="left-bar" href="#">
	      	<span class="glyphicon glyphicon-home"></span>
	      </a>
	      <span>购物车</span>
	      <a class="right-bar" href="#">
	      	<span class="glyphicon glyphicon-shopping-cart"></span>
	      </a>
	</div>
<!-- /header -->
     <div id="wrapper">
	<div id="scroller">
	<!-- content -->
	<div class="panel">
		<div class="panel-body">
	    <form class="form-inline" action="checkcart.html" method="post" data-ajax="false">
        <h4>商品列表</h4>
        <div id ="catHtml"></div>
                <h4>结算信息</h4>
        <div class="alert alert-info">
         <div id ="total"></div>
                    </div>
        <div>
            <a class="btn btn-default" href="javascript:emptycart();">清除购物车</a>  <!--回到最初的购物界面-->
            <input class="btn btn-danger" type="submit" value="去结算">
	    </div>
	    </form>
	</div>
	</div>
</div>

			</div>
	<!-- /content -->
	<!-- footer -->
	<div class="container dp-menu-box" id="footer">
		    <a class="pull-left menu-btn" href="go.html">
		    	<div class="menu-img glyphicon glyphicon-home"></div>
		    	<div><img src="images/1.png" height="40"></div>
		    </a>
		    <a class="pull-left menu-btn" href="listcat.html">
		    	<div class="menu-img glyphicon glyphicon-th-large"></div>
		    	<div><img src="images/2.png" height="40"></div>
		    </a>
		    <a class="pull-left menu-btn" href="gencart.html">
		    	<div class="menu-img glyphicon glyphicon-user"></div>
		    	<div><img src="images/3.png" height="40"></div>
		    	<div class="login-tag" style="display: none;"></div>
		    </a>
		    <a class="pull-left menu-btn" href="#">
		    	<div class="menu-img glyphicon glyphicon-shopping-cart"></div>
		    	<div><img src="images/4.png" height="40"></div>
		    </a>
		  </div>
	<!-- /footer -->
	<script type="text/javascript">
	    function update_cart(e,n){
	    	$.ajax({
				  url: "#",
				  cache: false,
				  type: "POST",
				  data:{'obj_ident':e,'num':n},
				  success: function(html){
					  location.href="mcart.html";
				  }
		    });
	    }

	    function update_minus(e){
	    	$num = $('#'+e).val();
	    	$num--;
	    	if($num<=1){
	    		$('#'+e).val(1);
	    		//update_cart(e,1);  //
	    	}else{
	    		$('#'+e).val($num);
	    		//update_cart(e,$num);
	    	}

	    }

	    function update_plus(e){
	    	$num = $('#'+e).val();
	    	$num++;
	    	if($num>=10){
	    		$('#'+e).val(10);
	    		//update_cart(e,10);
	    	}else{
	    		$('#'+e).val($num);
	    		//update_cart(e,$num);
	    	}
	    }

		
	</script>
</div>
<!-- /page -->
<!-- S criteo ---->
<script type="text/javascript">
window.criteo_q = window.criteo_q || [];
window.criteo_q.push(
        { event: "setAccount", account: 15335 },
        { event: "setCustomerId", id: $.cookie('UNAME') ? '"'+$.cookie('UNAME')+'"' : '' },
        { event: "setSiteType", type: "m" },
        { event: "viewBasket", item: [
			                { id: "596", price: 26, quantity: 3 },
                            { id: "710", price: 149, quantity: 1 }
              ]});
</script>
</body>
</html>