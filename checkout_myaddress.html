<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title></title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="telephone=no" name="format-detection" />
<link href="css/jquery.mobile-1.3.2.css" rel="stylesheet" type="text/css" media="screen, projection" />
<link href="css/jquery.mobile.my.css" rel="stylesheet" type="text/css" media="screen, projection" />
<link href="css/my.mobile-1.0.css" rel="stylesheet" type="text/css" media="screen, projection" />
<link href="css/jquery.nivo.slider-3.2.css" rel="stylesheet" type="text/css" media="screen, projection" />

<script type="text/javascript" src="css/jquery-1.10.2.js"></script>
<script type="text/javascript" src="css/jquery.mobile-1.3.2.js"></script>
<script type="text/javascript" src="css/jquery.nivo.slider-3.2.js"></script>
<script type="text/javascript" src="css/swipe-2.0.js"></script>
<script type="text/javascript" src="css/jquery.lazyload.js"></script>

<link href="fivegold.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="iscroll-lite.js"></script>
<script type="text/javascript" src="iscroll.js"></script>
<script type="text/javascript" src="fivegold.js"></script>
<script src="json2.js"></script>
<script src="jstorage.js"></script>
<script>
function deladdress(id){
	var userid = $.jStorage.get('userid');
	if (userid==null) {  document.location.href="login.html";}
	var xhr = new XMLHttpRequest();
	xhr.open("GET", "http://120.24.209.210/api/mobile.php?act=deladdress&id="+id+"&user_id="+userid, true);
	
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
			var resultfromphp = xhr.responseText;
			var objData = jQuery.parseJSON(resultfromphp);
			document.location.href="checkout_myaddress.html";
  		}
	};
	xhr.send();
}

function makeList() {
	var userid = $.jStorage.get('userid');
	if (userid==null)
        document.location.href="login.html";
	var xhr = new XMLHttpRequest();
	xhr.open("GET", "http://120.24.209.210/api/mobile.php?act=myaddressmgn&user_id="+userid, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    		var resultfromphp = xhr.responseText;
			var objData = jQuery.parseJSON(resultfromphp);
			var html ='';
	  		if (objData.listallcat.length>0){
			 $.each(objData.listallcat, function (index, term) {
				if ( term.default == '1')
				{
					html+='<section class=\"receiver checkout_section address_section address_section_on\">';
				}
				else 
				 {
					html+='<section class=\"receiver checkout_section address_section\">';
				 }
				
		        html+='<section class=\"address_info\">';
			    html+='<section class=\"address_name\">'+term.consignee+'&nbsp;'+term.mobile+'&nbsp;'+term.address_id+'(<a href="javascript:deladdress('+term.address_id+')">删除</a>)</section>';
			    html+='<section class=\"address_content\">'+term.address+'</section>';
		        html+='</section>';
		        html+='<section class=\"check_address\">';
				html+='<form class=\"check_address_form\" method=\"post\" data-ajax=\"false\" action=\"checkcart.html?address_id='+term.address_id+'\">';
				html+='<input type=\"hidden\" name=\"addr_id\" value='+term.address_id+'>';
			    html+='</form>';
				html+='</section>';
				html+='</section>';
			});
			document.getElementById('addressman').innerHTML=html;
            }else{}
  		}
	};
	xhr.send();
}

$(document).ready(function() {
	 makeList();
});
</script>
</head>
<body>
<div data-role="page" id="cart" data-title="我的订单">
	<!-- header -->
	<div data-role="header" data-theme="h">
	    <a href="checkcart.html" data-role="button" data-iconpos="notext" data-icon="arrow-l" data-ajax="false"></a>
	    <h1>我的地址</h1>
	</div>
	<!-- /header -->
	
	<!-- content -->
	<div data-role="content" id="addressman">
		<section class="receiver checkout_section address_section address_section_on">
			<section class="address_info">
				<section class="address_name">收件人&nbsp;电话</section>
				<section class="address_content">数据正在努力传到页面</section>
			</section>
			<section class="check_address">
				<form class="check_address_form" action="checkcart.html?address_id=" method="post" data-ajax="false">
					<input type="hidden" name="address_id" value="">
			    </form>
			</section>
		</section>
	</div>
	<!-- /content -->

	<div data-role="footer" data-theme="c">
	    <div style="padding:5px 5px;">
	    <input id="new_address_btn" type="button" value="添加新地址" data-mini="false">
	    </div>
    </div>

<script type="text/javascript">
	$('.receiver').click(function(){
		$(this).siblings().removeClass('address_section_on');
		$(this).addClass('address_section_on');
		$(this).find('.check_address_form').submit();
	});

	$('#new_address_btn').click(function(){
		location.href="newaddress.html";
	});
	</script>
</div>
<!-- /page -->
</body>
</html>