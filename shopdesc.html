<html>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
 <meta http-equiv="Access-Control-Allow-Origin" content="*">

<title>五金APP</title>
<link href="jquery.mobile-1.0.min.css" rel="stylesheet" type="text/css"/>
<script src="jquery-1.6.4.min.js" type="text/javascript"></script>
<script src="jquery.mobile-1.0.min.js" type="text/javascript"></script>
<script type="text/javascript" src="fivegold.js"></script>

<link href="fivegold.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="iscroll-lite.js"></script>
      				<script type="text/javascript" src="iscroll.js"></script>
<script type="text/javascript" src="fivegold.js"></script>

<script>  
var shopid = request('shopid') ;
var imagecount = 0;
var currentimage = 0;
function makeList() {
	var xhr = new XMLHttpRequest();
	xhr.open("GET", "http://120.24.209.210/api/mobile.php?act=goodsdesc&goods_id="+shopid, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    		var resultfromphp = xhr.responseText;
			//alert(resultfromphp);
      		  var objData = jQuery.parseJSON(resultfromphp);
			 
			var html ='';
	  		
			 $.each(objData.listallcat, function (index, term) {	
			  imagecount = term.bought_goods.length;
			  if (imagecount>0)
			  {//初始化显示第一个图片
			  //html+='<img src='+term.bought_goods[currentimage].img_url+' id="shopimg" width="100%">';
			   //alert (term.bought_goods[currentimage].img_url);
			   document.getElementById('shopimg').src=term.bought_goods[currentimage].img_url;
			  }
			   html+='<li><h1>商品名称</h1><p>'+term.goods_name+'</p></li>';
			   html+='<li><h1>商品货号</h1><p>'+term.goods_sn+'</p></li>';
			   html+='<li><h1>商品简单说明</h1><p>'+term.goods_brief+'</p></li>';
			   html+='<li><h1>详细描述</h1><p>'+term.goods_desc+'</p></li>';
			   html+='<li><h1>市场价格</h1><p>¥'+term.market_price+'</p></li>';
			   html+='<li><h1>商店售价</h1><p>¥'+term.shop_price+'</p></li>';
			
			   });
					 //alert(html);
            $('#listallcat').append($(html));
            $('#listallcat').trigger('create');    
            $('#listallcat').listview('refresh');
  		}
	};
	xhr.send();
	
}

$("#5gshoplist").live('pagebeforeshow', function(event) {
    makeList();
	//为页面添加swip 事件
    //当我们向右滑动的时候,进入下一图片
    $('#shopimg').bind("swiperight",  function(){
           //alert('swiperight');
            showNextImage();
     });
	//当我们向左滑动的时候,进入下一图片
    $('#shopimg').bind("swipeleft",  function(){
    //alert('swipeleft');
            showNextImage();
     });
});

function hide(){
$.mobile.hidePageLoadingMsg();
}
$(document).ready(function() {
    setTimeout("hide()",2000);
    $.mobile.showPageLoadingMsg();
});

function addtocart(){
var xhr = new XMLHttpRequest();
     var posturl = "http://120.24.209.210/api/mobile.php?act=addbuycart&goods_id="+shopid+"&number=1&userid=24";
	//alert(posturl);  	
	xhr.open("GET", posturl, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    	       	var resultfromphp = xhr.responseText;
			alert("添加成功");
      		      var objData = jQuery.parseJSON(resultfromphp);
			 //alert (objData.rsgmsg);
		}
	};
	xhr.send();
}

function showNextImage(){
var xhr = new XMLHttpRequest();
	xhr.open("GET", "http://120.24.209.210/api/mobile.php?act=goodsdesc&goods_id="+shopid, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    		var resultfromphp = xhr.responseText;
			//alert(resultfromphp);
      		  var objData = jQuery.parseJSON(resultfromphp);
			 
			 $.each(objData.listallcat, function (index, term) {	
			  //alert(imagecount);
			  //alert(currentimage);
			  
			  if (imagecount>0 && currentimage<imagecount-1)
			  {
		      //alert(document.getElementById('shopimg').src);
			  //alert(term.bought_goods[++currentimage].img_url);
			  //显示下一张图片
			  document.getElementById('shopimg').src=term.bought_goods[++currentimage].img_url;
			  }else{
				 currentimage=0;
				 document.getElementById('shopimg').src=term.bought_goods[currentimage].img_url;
			  }
			   });
			
  		}
	};
	xhr.send();	
}
function collect(){
var xhr = new XMLHttpRequest();
     var posturl = "http://120.24.209.210/api/mobile.php?act=collect&goods_id="+shopid+"&rec_id=24";
	//alert(posturl);  	
	xhr.open("GET", posturl, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    	       	var resultfromphp = xhr.responseText;
			//alert(resultfromphp);
			//alert("添加成功");
      		      var objData = jQuery.parseJSON(resultfromphp);
			 alert (objData.rsgmsg);
		}
	};
	xhr.send();
}	
	
/*
            //在页面初始化的时候,利用phonegap初始化我们的应用
            $('body').live("pageinit",function(){
               init();
            });
           
           */
 
       	
/*
    $(function() {  
  
        $("#5gshopdescimg1").bind("swiperight", function() {  
            $.mobile.changePage("#5gshopdescimg2");
        });  
         $("#5gshopdescimg1").bind("swipeleft", function() {  
            $.mobile.changePage("#5gshopdescimg2");
        });  
		
		 $("#5gshopdescimg2").bind("swipeleft", function() {  
            $.mobile.changePage("#5gshopdescimg1", {  
                transition : "slide",  
                reverse : true  
            }, true, true);  
        });  
        $("#5gshopdescimg2").bind("swiperight", function() {  
            $.mobile.changePage("#5gshopdescimg1", {  
                transition : "slide",  
                reverse : true  
            }, true, true);  
        });  
  
    });
	*/  
</script>  

</head> 
<body scrolling="no"> 

<div data-role="page" id="5gshoplist">
	<div data-role="header" data-theme="none" id="header" class="home_image">
     <div class="ui-grid-b">
	    <div class="ui-block-a" align="left"><a href="javascript:history.go(-1)" style="-webkit-border-radius:5px; background:-webkit-gradient(linear, 0 0, 0 100%, from(#ffd167), to(#efa823));border:1px solid #b77012;color:#854d00; text-decoration:none;width:80px;height:38px; display:block; text-align:center; line-height:41px;text-shadow:none;font-size:16px;margin-top:1px;">返回</a></div>
	    <div class="ui-block-b" align="left"></div>
	    <div class="ui-block-c" align="left"></div>
     </div>
     </div>
     		 <div id="wrapper">
	<div id="scroller">
	<div data-role="content" >
       
<ul data-role="listview" id="listallcat">
  <img src="xhdpi.png" id="shopimg" width="200px"/>
</ul>
       </div>
       </div>		
	</div>
<div data-role="footer" style="width:100%;height:60px;" id="footer">
 <div class="ui-grid-b">
	    <div class="ui-block-a"><a href="javascript:collect();"><img src="images/focus.png"  height="40"></a></div>
	    <div class="ui-block-b"><a href="javascript:addtocart();"><img src="images/addtocart.png" height="40"></a></div>
	    <div class="ui-block-c" align="right"><a href="shopcart.html"  rel="external" data-transition="slide"><img src="images/cart.png"  height="40"></a></div>
      </div>
    
	</div>
</div>



</body>
</html>
