
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>app</title>
	<meta name="keywords" content="#">
	<meta name="description" content="#">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta content="telephone=no" name="format-detection" />
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<script src="css/jquery-1.10.2.min.js"></script>
	<script src="css/jquery.cookie.js"></script>
	<script src="css/bootstrap.min.js"></script>
	<link href="css/base.mobile.css" rel="stylesheet" type="text/css" media="screen, projection" />
	<script type="text/javascript" src="fivegold.js"></script>
	<link href="fivegold.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="fivegold.js"></script>
	<script src="json2.js"></script>
	<script src="jstorage.js"></script>
<script>  
var shopid = request('goodsid') ;
var imagecount = 0;
var currentimage = 0;

function makecartNum() {
	var userid = $.jStorage.get('userid');
	if (userid==null)
        document.location.href="login.html"
	var xhr = new XMLHttpRequest();
	xhr.open("POST", "http://120.24.209.210/api/mobile.php?act=buylistcart&user_id="+userid, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
			var resultfromphp = xhr.responseText;
			var objData = jQuery.parseJSON(resultfromphp);      		  
			//document.getElementById('cartnum').value="购物车("+objData.total.real_goods_count+")";
			document.getElementById('cartnum').innerHTML="("+objData.total.real_goods_count+")";
		}
	};
	xhr.send();	
}

function makeList() {
	 // alert(shopid+specval.label+);
	var xhr = new XMLHttpRequest();
	xhr.open("POST", "http://120.24.209.210/api/mobile.php?act=goodsdesc&goods_id="+shopid, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    		var resultfromphp = xhr.responseText;
			//alert(resultfromphp);
      		  var objData = jQuery.parseJSON(resultfromphp);
			 
			var html ='';
	  		
			 $.each(objData.listallcat, function (index, term) {	
			  imagecount = term.bought_goods.length;
			  if (imagecount>0)
			  {//初始化显示第一个图片
			   document.getElementById('shopimg').src=term.bought_goods[currentimage].img_url;			 
			  }
			   document.getElementById('goods_name').innerHTML=term.goods_name;
			   document.getElementById('goods_sn').innerHTML=term.goods_sn;
			   document.getElementById('goods_brief').innerHTML=term.goods_brief;
			   var html = "";
			   $.each(term.specification, function (index, spec) {
				$.each(spec.values, function (index, specval) {
			   html+="<span style=\"display:inline-block;margin:2px 2px;\" class=\"label label-default\"  onclick=\"selectGoods(this,"+specval.price+")\" id=\""+specval.id+"\">"+specval.label+"</span>";
			     });
				});
			   document.getElementById('specification').innerHTML=html;
			   //document.getElementById('market_price').innerHTML='<s>￥'+term.market_price+'</s>';
			   document.getElementById('shop_price').innerHTML='￥'+term.shop_price;
			   
			 makecartNum();
			 /*html+='<li><h1>商品名称</h1><p>'+term.goods_name+'</p></li>';
			   html+='<li><h1>商品货号</h1><p>'+term.goods_sn+'</p></li>';
			   html+='<li><h1>商品简单说明</h1><p>'+term.goods_brief+'</p></li>';
			   html+='<li><h1>详细描述</h1><p>'+term.goods_desc+'</p></li>';
			   html+='<li><h1>市场价格</h1><p>¥'+term.market_price+'</p></li>';
			   html+='<li><h1>商店售价</h1><p>¥'+term.shop_price+'</p></li>';
			*/
			   });
  		}
	};
	xhr.send();
	
}

var cartprice = 0;
function selectGoods(that,price){
	document.getElementById('shop_price').innerHTML='￥'+price;
	//alert(that.id);
	spec=that.id;
	cartprice = price;		   
}
$(document).ready(function() {
	 makeList();
});

var spec = 0;

function addtocart(){
	var userid = $.jStorage.get('userid');
     if (userid==null)
        document.location.href="login.html";
	var xhr = new XMLHttpRequest();
     var goods_num = document.getElementById('goods_num').value;
	if (cartprice!=0)
	 var posturl = "http://120.24.209.210/api/mobile.php?act=addbuycart&goods_id="+shopid+"&number="+goods_num+"&userid="+userid+"&spec="+spec+"&price="+cartprice;	 
	else
     var posturl = "http://120.24.209.210/api/mobile.php?act=addbuycart&goods_id="+shopid+"&number="+goods_num+"&userid="+userid+"&spec="+spec;

	xhr.open("POST", posturl, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
    	       	var resultfromphp = xhr.responseText;
      		    var objData = jQuery.parseJSON(resultfromphp);
		}
	};
	xhr.send();
	window.setTimeout(function(){ makecartNum();},100);
	return true;

}

function showNextImage(){
	var shopid=request('goodsid');
	var xhr = new XMLHttpRequest();
	xhr.open("GET", "http://120.24.209.210/api/mobile.php?act=goodsdesc&goods_id="+shopid, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
			var resultfromphp = xhr.responseText;
			var objData = jQuery.parseJSON(resultfromphp);
			$.each(objData.listallcat, function (index, term) {	
			  //alert(imagecount);
			  //alert(currentimage);
			  
			  if (imagecount>0 && currentimage<imagecount-1)
			  {
				  //alert(document.getElementById('shopimg').src);
				  //alert(term.bought_goods[++currentimage].img_url);
				  //显示下一张图片
				  document.getElementById('shopimg').src=term.bought_goods[++currentimage].img_url;
			  }
			  else{
				 currentimage=0;
				 document.getElementById('shopimg').src=term.bought_goods[currentimage].img_url;
			  }
			});
  		}
	};
	xhr.send();	
	return true;
}
function collect(){
	var userid = $.jStorage.get('userid');
	if (userid==null)
        document.location.href="login.html";
	var xhr = new XMLHttpRequest();
	var posturl = "http://120.24.209.210/api/mobile.php?act=collect&goods_id="+shopid+"&user_id="+userid;
	//alert(posturl);  	
	xhr.open("GET", posturl, true);
	xhr.onreadystatechange = function() {
  		 if (xhr.readyState==4 && xhr.status==200){
			var resultfromphp = xhr.responseText;
			//alert(resultfromphp);
			//alert("添加成功");
			var objData = jQuery.parseJSON(resultfromphp);
			// alert(objData.rsgmsg);
			//document.getElementById('alertmsg2').innerHTML=objData.rsgmsg;
			//alert(document.getElementById('alertmsg2'));
			//$('#collect_dialog').show(); 
		}
	};
	xhr.send();
	return true;
}	
	
function update_plus(){
	 document.getElementById('goods_num').value = parseInt(document.getElementById('goods_num').value)+1;
}

function update_minus(){
	if (document.getElementById('goods_num').value > 1)
	document.getElementById('goods_num').value = parseInt(document.getElementById('goods_num').value)-1;
}
</script>  
</head>

<body scrolling="no">
<div class="user-ui-page"  id="5gshoplist">
	<!-- header -->
    <div class="user-ui-header clearfix" id="header">
	     <a class="left-bar" href="javascript:history.go(-1);">
	     	<span class="navbar-brand glyphicon glyphicon-chevron-left"></span>
	     </a>
	     <span>商品详情</span>
	     <a class="right-bar" href="gencart.html">
	     	<span class="glyphicon glyphicon-shopping-cart"></span>
	     </a>
    </div>
    <!-- /header -->
    <div id="wrapper">
	<div id="scroller">
	
<div class="container"style="padding-top:70px">
<style>
.swiper-container, .swiper-slide {
  width:80%;
  height:auto;
}
.swiper-container .previous{
	position: absolute;
	top: 40%;
	left: 25px;
	cursor: pointer;
	background: url(img/bg101.png) no-repeat top left;
	width: 24px;
	height: 48px;
	cursor: pointer;
	text-indent: -9999px;
	display: block;
}
.swiper-container .next{
    position: absolute;
	top: 40%;
	right: 25px;
	cursor: pointer;
	background: url(img/bg101.png) no-repeat top right;
	width: 24px;
	height: 48px;
	cursor: pointer;
	text-indent: -9999px;
	display: block;
}
</style>
<div class="swiper-container">
	<div class="swiper-wrapper">
		<div class="swiper-slide" align="center">
			<img id="shopimg"  width="80%" src="img/logo.png" border="0">
	    </div>
	</div>
	<a href="javascript:showNextImage();"><div class="previous">Previous</div></a>
	<a href="javascript:showNextImage();"><div class="next">Next</div></a>
</div>
</div>

<link rel="stylesheet" href="css/idangerous.swiper.css">
<script src="css/idangerous.swiper.min.js"></script>
	
<div class="user-ui-info">
	<table class="table">
		<tr>
			<td width="120px">商品名称：</td>
			<td><span id="goods_name"></span></td>
		   </tr>
		<tr>
		   	<td>简单说明：</td>
		   	<td><span id="goods_brief"></span></td>
		</tr>

		<tr>
			<td><label>商品编码：</label></td>
		    <td>
		    	<span id="goods_sn"></span>
		    </td>
		</tr>

		   <!--tr>
		     <td>
		     <label>市场价：</label>
		     </td>
		     <td>
		     	<span id="market_price" style="color:#b10000;"></span>
		     </td>
		   </tr-->
		 <tr>
		     <td>
		     <label>数量说明:</label>
		     </td>
		     <td>
		     	<span id="shop_desc" style="color:#b10000;"></span>
		     </td>
		   </tr>
		 <tr>
		    <td><label>尺寸：</label></td>
		    <td class="spec_list">
		     	<span id="specification" ></span>
			</td>
		 </tr>
		 <tr>
		     <td>
		     <label>销售价：</label>
		     </td>
		     <td>
		     	<span id="shop_price" style="color:#b10000;"></span>
		     </td>
		   </tr>

		</table>
	    <div class="m_10_0" style="padding:0 10px;">
           	   <div class="form-group">
           	       <input class="btn btn-default" id="minus_product" type="button" onClick="update_minus()" value="-">
		           <input class="form-control" name="goods[num]" data-role="none" style="width:50px;display:inline-block;" type="text" id="goods_num" min="1" max="10" value="1">
		       	   <input class="btn btn-default" id="plus_product"  type="button" onClick="update_plus()" value="+">
		       </div>
        	   <div class="alert alert-danger m_5_0" id="tishi" style="display:none;"></div>
        	   <div class="m_5_0">
			   </div> 
		</div>
		</div>
	</div>
	<!-- /content -->
		
		
<div id="dp_footer" class="dp-footer	">
		<nav class="navbar navbar-default navbar-fixed-bottom" role="navigation">
		  <div class="container dp-menu-box">
					<a class="btn btn-warning" style="width:80px"  href="javascript:collect();">关注</a>
					<a class="btn btn-danger" style="width:100px"  href="javascript:addtocart();">加入购物车</a>
					<a class="right-bar" href="gencart.html">
						<span class="glyphicon glyphicon-shopping-cart btn-lg"><span id="cartnum" style="font-size:small" ></span></span>
					</a>
	
		  </div>
		</nav>
</div>
<!-- /page -->
<!-- 底部导航  -->
		   
<div class="modal fade" style="padding-left:100px;padding-top:50px" id="addtocart_dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">购物车添加成功</h4>
      </div>
      <div class="modal-body" id="alertmsg">
           
      </div>
      <div class="modal-footer">
        <button id="login" type="button" class="btn btn-info" onclick="javascript:void(0)" data-dismiss="modal">确认</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" style="padding-left:100px;padding-top:50px" id="collect_dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">关注成功</h4>
      </div>
      <div class="modal-body" id="alertmsg2">
          
      </div>
      <div class="modal-footer">
        <button id="login" type="button" class="btn btn-info" onclick="javascript:void(0)" data-dismiss="modal">确认</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


</body>
</html>